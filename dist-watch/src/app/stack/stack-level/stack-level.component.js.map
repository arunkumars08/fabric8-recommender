{"version":3,"file":"stack-level.component.js","sourceRoot":"","sources":["../../../../../src/app/stack/stack-level/stack-level.component.ts"],"names":[],"mappings":"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","sourcesContent":["import {Component, Input, OnChanges, Output, EventEmitter} from '@angular/core';\n\nimport {UserStackInfoModel, ComponentInformationModel} from '../models/stack-report.model';\n\n@Component({\n    selector: 'stack-level-information',\n    templateUrl: './stack-level.component.html',\n    styleUrls: ['./stack-level.component.scss'],\n})\n\nexport class StackLevelComponent {\n    @Input() userStack: UserStackInfoModel;\n    @Input() outliers: any;\n\n    @Output() changeFilter: EventEmitter<any> = new EventEmitter();\n\n    public licenseInfo: any = {};\n    public securityInfo: any = {};\n\n    constructor() {}\n\n    ngOnChanges(): void {\n        if (this.userStack) {\n            this.handleLicenseInformation(this.userStack);\n            this.handleSecurityInformation(this.userStack);\n        }\n        if (this.outliers) {\n            this.handleStatistics(this.outliers);\n        }\n    }\n\n    public handleFilter(filterBy: any): void {\n        this.changeFilter.emit(filterBy);\n    }\n\n    private handleStatistics(outliers: any): void {\n        \n    }\n\n    private sortChartColumnData(array: Array<Array<any>>): Array<Array<any>> {\n        return array.sort((a, b) => {\n            if (a[1] === b[1]) {\n                return 0;\n            }\n            return a[1] > b[1] ? -1 : 1;\n        });\n    }\n\n    private handleSecurityInformation(tab: UserStackInfoModel): void {\n        let dependencies: Array<ComponentInformationModel> = tab.dependencies;\n        let security: Array<any> = [];\n        let temp: Array<any> = [];\n        \n        dependencies.forEach((dependency) => {\n            security = dependency.security;\n            if (security.length > 0) {\n                let max: any = security.reduce((a, b) => {\n                    return parseFloat(a['CVSS']) < parseFloat(b['CVSS']) ? b : a;\n                });\n                temp.push({\n                    name: dependency.name,\n                    cve: max\n                });\n            }\n        });\n        if (temp.length > 0) {\n            let final: any = temp.reduce((a, b) => {\n                return parseFloat(a['cve']['CVSS']) < parseFloat(b['cve']['CVSS']) ? b : a;\n            });\n            let cvssValue: number = final.cve.CVSS;\n            let indicator: number;\n            let iconClass: string = 'fa fa-shield';\n            let displayClass: string = 'progress-bar-warning';\n\n            if (cvssValue < 0) {\n                indicator = -1;\n            }\n            if (cvssValue >= 7.0) {\n                indicator = cvssValue;\n                iconClass = 'fa fa-shield';\n                displayClass = 'progress-bar-danger';\n            }\n            this.securityInfo = {\n                name: final.name,\n                cve: final.cve,\n                percentage: final.cve.CVSS * 10,\n                status: final.cve.CVSS < 7 ? 'moderate' : 'critical',\n                iconClass: iconClass,\n                displayClass: displayClass\n            };\n        }\n    }\n\n    private handleLicenseInformation(tab: UserStackInfoModel): void {\n        \n        let licenses: any = {};\n        let columnData: Array<Array<any>> = [];\n        let columnDataLength: number = 0;\n        let otherLicensesArray: Array<string> = [];\n        let otherLicensesRatio: any = 0;\n\n        let temp: Array<any> = [];\n\n        tab.dependencies.forEach((t) => {\n            t.licenses.forEach((license) => {\n                if (!licenses[license]) {\n                    licenses[license] = 1;\n                } else {\n                    ++ licenses[license];\n                }\n            });\n        });\n        for (let i in licenses) {\n            if (licenses.hasOwnProperty(i)) {\n                // Push names and count to be in this structure ['Name', 20] for C3\n                temp = [];\n                temp.push(i);\n                temp.push(licenses[i]);\n                columnData.push(temp);\n            }\n        }\n        // sort the data array by license count\n        columnData = this.sortChartColumnData(columnData);\n        columnDataLength = columnData ? columnData.length : 0;\n        if (columnDataLength > 4) {\n            for (let i = 3; i < columnDataLength; i++) {\n                otherLicensesArray.push(columnData[i][0]);\n                otherLicensesRatio += columnData[i][1];\n            }\n            columnData.splice(4);\n            columnData[3][0] = 'Others';\n            columnData[3][1] = otherLicensesRatio;\n        }\n        console.log(columnData);\n        this.licenseInfo = {\n            data: {\n                columns: columnData,\n                type: 'donut',\n                labels: false\n            },\n            chartOptions: {\n                size: {\n                    height: 150,\n                    width: 250\n                },\n                donut: {\n                    width: 13,\n                    label: {\n                        show: false\n                    },\n                    title: columnDataLength + ' Licenses'\n                }\n            },\n            configs: {\n                legend: {\n                    position: 'right'\n                },\n                tooltip: {\n                    format: {\n                        name: (name, ratio, id, index) => {\n                            if (name === 'Others') {\n                                return otherLicensesArray.toString();\n                            }\n                            return name;\n                        },\n                        value: (value, ratio, id, index) => {\n                            return (ratio * 100).toFixed(2) + '%';\n                        }\n                    }\n                }\n            }\n        };\n        console.log (licenses);\n    }\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}